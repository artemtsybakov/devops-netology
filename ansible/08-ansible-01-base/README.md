# Домашнее задание к занятию 1 «Введение в Ansible»

## Основная часть
1. Попробуйте запустить playbook на окружении из `test.yml`, зафиксируйте значение, которое имеет факт `some_fact` для указанного хоста при выполнении playbook.
    
   ```
   ansible-playbook site.yml -i ./inventory/test.yml

   PLAY [Print os facts] ***********************************************************************************************************************************************************************************************************
   
   TASK [Gathering Facts] **********************************************************************************************************************************************************************************************************
   ok: [localhost]
   
   TASK [Print OS] *****************************************************************************************************************************************************************************************************************
   ok: [localhost] => {
       "msg": "Ubuntu"
   }
   
   TASK [Print fact] ***************************************************************************************************************************************************************************************************************
   ok: [localhost] => {
       "msg": 12
   }
   
   PLAY RECAP **********************************************************************************************************************************************************************************************************************
   localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 
   ``` 

2. Найдите файл с переменными (group_vars), в котором задаётся найденное в первом пункте значение, и поменяйте его на `all default fact`.
   ```
   cat group_vars/all/examp.yml
   ---
     some_fact: all default fact
   ```
   ```
   ansible-playbook site.yml -i ./inventory/test.yml

   PLAY [Print os facts] ***********************************************************************************************************************************************************************************************************
   
   TASK [Gathering Facts] **********************************************************************************************************************************************************************************************************
   ok: [localhost]
   
   TASK [Print OS] *****************************************************************************************************************************************************************************************************************
   ok: [localhost] => {
       "msg": "Ubuntu"
   }
   
   TASK [Print fact] ***************************************************************************************************************************************************************************************************************
   ok: [localhost] => {
       "msg": "all default fact"
   }
   
   PLAY RECAP **********************************************************************************************************************************************************************************************************************
   localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
   ```
3. Воспользуйтесь подготовленным (используется `docker`) или создайте собственное окружение для проведения дальнейших испытаний.
   Для выполнения подготовил свое собственное окружение [compose.yaml](./playbook/compose.yaml). На образ ubuntu:22.04 установил Python [dockerfile](./playbook/dockerfile). В образе centos:7 Python уже установлен.
4. Проведите запуск playbook на окружении из `prod.yml`. Зафиксируйте полученные значения `some_fact` для каждого из `managed host`.
   ```
   ansible-playbook site.yml -i ./inventory/prod.yml
   
   PLAY [Print os facts] ***********************************************************************************************************************************************************************************************************
   
   TASK [Gathering Facts] **********************************************************************************************************************************************************************************************************
   ok: [ubuntu]
   ok: [centos]
   
   TASK [Print OS] *****************************************************************************************************************************************************************************************************************
   ok: [centos] => {
       "msg": "CentOS"
   }
   ok: [ubuntu] => {
       "msg": "Ubuntu"
   }
   
   TASK [Print fact] ***************************************************************************************************************************************************************************************************************
   ok: [centos] => {
       "msg": "el"
   }
   ok: [ubuntu] => {
       "msg": "deb"
   }
   
   PLAY RECAP **********************************************************************************************************************************************************************************************************************
   centos                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
   ubuntu                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  
   ```
5. Добавьте факты в `group_vars` каждой из групп хостов так, чтобы для `some_fact` получились значения: для `deb` — `deb default fact`, для `el` — `el default fact`.
   ```
   cat group_vars/deb/examp.yml
   ---
   some_fact: "deb default fact"
   ```
   ```
   cat group_vars/el/examp.yml
   ---
   some_fact: "el default fact"
   ```
6. Повторите запуск playbook на окружении `prod.yml`. Убедитесь, что выдаются корректные значения для всех хостов.
   ```
   ansible-playbook site.yml -i ./inventory/prod.yml
   
   PLAY [Print os facts] ***********************************************************************************************************************************************************************************************************
   
   TASK [Gathering Facts] **********************************************************************************************************************************************************************************************************
   ok: [ubuntu]
   ok: [centos]
   
   TASK [Print OS] *****************************************************************************************************************************************************************************************************************
   ok: [centos] => {
       "msg": "CentOS"
   }
   ok: [ubuntu] => {
       "msg": "Ubuntu"
   }
   
   TASK [Print fact] ***************************************************************************************************************************************************************************************************************
   ok: [centos] => {
       "msg": "el default fact"
   }
   ok: [ubuntu] => {
       "msg": "deb default fact"
   }
   
   PLAY RECAP **********************************************************************************************************************************************************************************************************************
   centos                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
   ubuntu                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 
   ```
7. При помощи `ansible-vault` зашифруйте факты в `group_vars/deb` и `group_vars/el` с паролем `netology`.
   group_vars/el
   ```
   ansible-vault encrypt_string 'el default fact' --name 'some_fact'
   New Vault password: 
   Confirm New Vault password: 
   Encryption successful
   some_fact: !vault |
             $ANSIBLE_VAULT;1.1;AES256
             39316138633136373364383934326563393065336636656434346664326230343862353836646665
             6133396432623066383635333665636237316163396363660a363233333439363831653131643461
             61646539353161343631353234313239656365313834346166306261353535383262643535383338
             3234383162353735650a373435336432323335373131623533636232306664396532643836343662
             3031
   ```
   group_vars/deb
   ```
   ansible-vault encrypt_string 'deb default fact' --name 'some_fact'
   New Vault password: 
   Confirm New Vault password: 
   Encryption successful
   some_fact: !vault |
             $ANSIBLE_VAULT;1.1;AES256
             39306234323465633463336165306136626632323539386264376436666434643439326266393538
             6165313432313265323431356365333132663335653033390a393033396465383032393862623263
             36653030633732313930643937383862303737343364613563646330393730613264326132653638
             3838336332306666300a366532313165316137393038326363626132313562323833623931343834
             36653836303463653036633034353465633035316362376235626432613236356561
   ```
8. Запустите playbook на окружении `prod.yml`. При запуске `ansible` должен запросить у вас пароль. Убедитесь в работоспособности.
   ```
   ansible-playbook site.yml -i ./inventory/prod.yml --ask-vault-pass
   Vault password: 
   
   PLAY [Print os facts] ***********************************************************************************************************************************************************************************************************
   
   TASK [Gathering Facts] **********************************************************************************************************************************************************************************************************
   ok: [ubuntu]
   ok: [centos]
   
   TASK [Print OS] *****************************************************************************************************************************************************************************************************************
   ok: [centos] => {
       "msg": "CentOS"
   }
   ok: [ubuntu] => {
       "msg": "Ubuntu"
   }
   
   TASK [Print fact] ***************************************************************************************************************************************************************************************************************
   ok: [centos] => {
       "msg": "el default fact"
   }
   ok: [ubuntu] => {
       "msg": "deb default fact"
   }
   
   PLAY RECAP **********************************************************************************************************************************************************************************************************************
   centos                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
   ubuntu                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 
   ```
9. Посмотрите при помощи `ansible-doc` список плагинов для подключения. Выберите подходящий для работы на `control node`.
   ansible.builtin.local 
   Этот подключаемый модуль позволяет ansible выполнять задачи на "контроллере" Ansible, а не на удаленном хосте.
10. В `prod.yml` добавьте новую группу хостов с именем  `local`, в ней разместите localhost с необходимым типом подключения.
   ```
   cat ./inventory/prod.yml
   ---
     el:
       hosts:
         centos:
           ansible_connection: docker
     deb:
       hosts:
         ubuntu:
           ansible_connection: docker
     local:
       hosts:
         my-local:
           ansible_connection: redirected_local
   ```
11. Запустите playbook на окружении `prod.yml`. При запуске `ansible` должен запросить у вас пароль. Убедитесь, что факты `some_fact` для каждого из хостов определены из верных `group_vars`.
   ```
   ansible-playbook site.yml -i ./inventory/prod.yml --ask-vault-pass
   Vault password: 
   
   PLAY [Print os facts] ***********************************************************************************************************************************************************************************************************
   
   TASK [Gathering Facts] **********************************************************************************************************************************************************************************************************
   ok: [ubuntu]
   ok: [my-local]
   ok: [centos]
   
   TASK [Print OS] *****************************************************************************************************************************************************************************************************************
   ok: [centos] => {
       "msg": "CentOS"
   }
   ok: [ubuntu] => {
       "msg": "Ubuntu"
   }
   ok: [my-local] => {
       "msg": "Ubuntu"
   }
   
   TASK [Print fact] ***************************************************************************************************************************************************************************************************************
   ok: [my-local] => {
       "msg": "all default fact"
   }
   ok: [centos] => {
       "msg": "el default fact"
   }
   ok: [ubuntu] => {
       "msg": "deb default fact"
   }
   
   PLAY RECAP **********************************************************************************************************************************************************************************************************************
   centos                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
   my-local                   : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
   ubuntu                     : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  
   ```
12. Заполните `README.md` ответами на вопросы. Сделайте `git push` в ветку `master`. В ответе отправьте ссылку на ваш открытый репозиторий с изменённым `playbook` и заполненным `README.md`.
13. Предоставьте скриншоты результатов запуска команд.

